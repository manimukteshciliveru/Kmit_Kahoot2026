const path = require('path');
require('dotenv').config({ path: path.join(__dirname, '../.env') });
const mongoose = require('mongoose');
const User = require('../models/User');

const studentsData = `
24BD1A6601	CSM A	AKAVARAM SAI BARADWAJ
24BD1A6602	CSM A	AKULA MANOHAR BALAJI
24BD1A6603	CSM A	ANNABATHULA YUVA DHANVANTH
24BD1A6604	CSM A	AVADHANAM AARYAN ABHIRAM
24BD1A6605	CSM A	AVANI JAHAGIRDAR
24BD1A6606	CSM A	BONGONI SIDDHARTH
24BD1A6607	CSM A	CHALLAGUNDLA MANOJ KUMAR
24BD1A6608	CSM A	CHAPALA SAI SIDDHARTHA
24BD1A6609	CSM A	CHENNEMONI SAI PRANEETH
24BD1A660A	CSM A	CHOWTAPELLY TEJASWI
24BD1A660B	CSM A	DAMERA HIMA SREE
24BD1A660C	CSM A	DANTHALA SATHWIK CHANDU
24BD1A660D	CSM A	DHANUSH REDDY BODDU
24BD1A660E	CSM A	DODDI BHAVYA ASMITHA
24BD1A660F	CSM A	GADDAM SHIVA CHARAN
24BD1A660G	CSM A	GAJULA AMOOLYA
24BD1A660H	CSM A	GOLLA SATVIK KUMAR
24BD1A660J	CSM A	GOPIDI DHEERAJ REDDY
24BD1A660K	CSM A	GUDUPALLY ASHOK REDDY
24BD1A660L	CSM A	GURRAM PARDHA VENKATA SAI KUMAR
24BD1A660M	CSM A	JABEER SADIQ SHEIKH
24BD1A660N	CSM A	KALAHASTI SRI DHRUTI
24BD1A660P	CSM A	KALAVAKUNTLA BINDU SIVA MADHAV
24BD1A660Q	CSM A	KARANAM SAMHITHAA DESAI
24BD1A660R	CSM A	KASARAGADDA RAM ROHIT
24BD1A660T	CSM A	KASI VAMSHI MOHAN
24BD1A660U	CSM A	KOMUROJU SAI RAUDHRAN
24BD1A660V	CSM A	KOTA PREETHAM
24BD1A660W	CSM A	KOTA SAI VARSHAN
24BD1A660X	CSM A	KRISHAN KUMAR AGARWAL
24BD1A660Y	CSM A	MADICHETTY SUCHAY SRINISCHAL
24BD1A660Z	CSM A	MADUGULA RAHUL REDDY
24BD1A6611	CSM A	MANGALAGIRI AISHWARYA
24BD1A6612	CSM A	MARLA YASWANTH REDDY
24BD1A6613	CSM A	MARRI SRINIKHITHA
24BD1A6614	CSM A	MIR ZAYNUL AABIDEEN ALI KHAN
24BD1A6615	CSM A	MOHAMMED SAQIB ANSARI
24BD1A6616	CSM A	MUNJALA TEJESH GOUD
24BD1A6617	CSM A	NAKKABALEPALLE SUBRAHMANYAM SAHARSH
24BD1A6618	CSM A	NALLA ADITYA REDDY
24BD1A6619	CSM A	NAVEEN BERA
24BD1A661A	CSM A	PATLOLLA BHUVAN KRISHNA REDDY
24BD1A661B	CSM A	PORELLA SAIRAAMM BHARADWAJ
24BD1A661C	CSM A	PULIJALA SAI NIKHILA
24BD1A661D	CSM A	PULLELA PAVAN TEJA
24BD1A661E	CSM A	PUNNA SRICHATUR
24BD1A661F	CSM A	PURANAM SRIYA
24BD1A661G	CSM A	RODDA VISHRUTH VAYU
24BD1A661H	CSM A	SANYA TATIA JAIN
24BD1A661J	CSM A	SHAIK ALTHAF AHMED
24BD1A661K	CSM A	SHAURYA SHEKHAR
24BD1A661L	CSM A	SHIPRA SHUKLA
24BD1A661M	CSM A	SIRI MOOTAKODURU
24BD1A661N	CSM A	SRIRAM VENKATA SAI
24BD1A661P	CSM A	SUMUKH AASHRITH DEEKONDA
24BD1A661Q	CSM A	SURISETTY ANIRUDH GUPTA
24BD1A661R	CSM A	SYAMALA JASHWANTH REDDY
24BD1A661T	CSM A	TANUKU V V S SAI TEJESH
24BD1A661U	CSM A	TELLA HIMAJA
24BD1A661V	CSM A	VAJRALA BHAVITH
24BD1A661W	CSM A	VANGA NIKETH
24BD1A661X	CSM A	VEMPATI JAINENDRA
24BD1A661Y	CSM A	VYAMASANI KUSHAL
24BD1A661Z	CSM A	YANNAM YASASWI REDDY
24BD1A66K1	CSM A	YEGAMATI SUDEEP REDDY
24BD1A6621	CSM B	AALHA SRI HASINI REDDY
24BD1A6622	CSM B	AISHWARYA SHABAD
24BD1A6623	CSM B	ALUGURI VIHAR
24BD1A6624	CSM B	ALUGURI VIVEK
24BD1A6625	CSM B	ANNAM SAI HARI PRIYA
24BD1A6626	CSM B	ANNAPAREDDY SREETHI
24BD1A6627	CSM B	ARYAN JADHAV
24BD1A6628	CSM B	AWAR ARNAMSH
24BD1A6629	CSM B	AYUSH PATIL
24BD1A662A	CSM B	B SARAYU
24BD1A662B	CSM B	BAKUNA MOURYA
24BD1A662C	CSM B	BANOTHU RAHUL
24BD1A662D	CSM B	BIRRU SADHANA
24BD1A662E	CSM B	BUSSA NAGA SURAJ
24BD1A662F	CSM B	C CHANDRA HAASINI
24BD1A662G	CSM B	CHALLA MEGHANA
24BD1A662H	CSM B	CHILIMIKOTI RUSHIKESH
24BD1A662J	CSM B	CHINTALAPATI VENKATA KRISHNA BHASKARA KARTHIKEYA
24BD1A662K	CSM B	DACHEPALLI SHREEYANTH
24BD1A662L	CSM B	DONIKENA SATWIKA
24BD1A662M	CSM B	DORNALA HARSHA VARDHINI
24BD1A662N	CSM B	EEDALA EEKSHITH
24BD1A662P	CSM B	GADDAM VISHNUPRASAD
24BD1A662Q	CSM B	GARDAS BALAJI
24BD1A662R	CSM B	GUDIDEVUNI SRIKAR GOUD
24BD1A662T	CSM B	GUDUR KEERTHANA
24BD1A662U	CSM B	HANUMAPANAHALLI  NIDHI  BADRINATH
24BD1A662V	CSM B	JALAMANI BENNY HINN
24BD1A662W	CSM B	KALLU SATHWIKA REDDY
24BD1A662X	CSM B	KAMUNI SWAPNIL
24BD1A662Y	CSM B	KANDALA KAMALHASAN REDDY
24BD1A662Z	CSM B	KANKANALA CHAKRIDHAR REDDY
24BD1A6631	CSM B	KATTA SPANDHANA
24BD1A6632	CSM B	KESHAV RATHI
24BD1A6633	CSM B	KODURI VENKATA SRI RISHITHA
24BD1A6634	CSM B	KOGANTI THANUJA
24BD1A6635	CSM B	KOLAGANI HARSHAVARDHAN
24BD1A6636	CSM B	KOMMINENI SATHWIK
24BD1A6637	CSM B	MADHANI JAYANTHI
24BD1A6638	CSM B	MADHAV OJHA
24BD1A6639	CSM B	MALGI REDDY YASWANTH REDDY
24BD1A663A	CSM B	MAROUTHU BHARGAV CHOWDARY
24BD1A663B	CSM B	MARRI AYUSH
24BD1A663C	CSM B	MOHAMMED ABDUL FAISAL
24BD1A663D	CSM B	MOHAMMED EMAD UDDIN
24BD1A663E	CSM B	MUNGANDA VENKATA SAI KRISHNA PRANAV
24BD1A663F	CSM B	MUNUKUNTLA SPOORTHY
24BD1A663G	CSM B	NEENA PUPPALA
24BD1A663H	CSM B	P AKSHITHA
24BD1A663J	CSM B	PANDIRLA SRI SANNIDHA
24BD1A663K	CSM B	PASUPULA SRI KOUSTHUBHA
24BD1A663L	CSM B	RAGHAV BHATTAD
24BD1A663M	CSM B	RONTALA NISHITHA
24BD1A663N	CSM B	RYAGALLA SHARVANI
24BD1A663P	CSM B	SAI SATHWIK REDDY B
24BD1A663Q	CSM B	SALVER SAI DHIRAJ
24BD1A663R	CSM B	SAMUDRALA KOUSHIK
24BD1A663T	CSM B	SOMANCHI SURYA DHANUSH
24BD1A663U	CSM B	SREEPADAPU SRESHTA
24BD1A663V	CSM B	SRIGANDHAM VISHAL REDDY
24BD1A663W	CSM B	THENNETI VENKATA KRISHNA ABHINAV
24BD1A663X	CSM B	VADTHYA GOUTHAM
24BD1A663Y	CSM B	VANDANAPU SHISHIR
24BD1A663Z	CSM B	VELIMINETI NANDHI VARDHAN REDDY
24BD1A66K2	CSM B	YANAMALA RAVINDRANADH
24BD1A6641	CSM C	AGADHANDI RAM CHARAN
24BD1A6642	CSM C	ANTHATI NIKHIL
24BD1A6643	CSM C	AVUNOORI AKSHAYA
24BD1A6644	CSM C	B THANUSHRI
24BD1A6645	CSM C	BANALA AKSHAY REDDY
24BD1A6646	CSM C	BORU TEJASWINI
24BD1A6647	CSM C	BUDDHI VIVEKANAND
24BD1A6648	CSM C	CHINDAM SIDHARTH KUMAR
24BD1A6649	CSM C	DANDE BINDU LALITHA KUMARI
24BD1A664A	CSM C	DANDEM  HANSIKA  REDDY
24BD1A664B	CSM C	DASARAPU SRIKAR
24BD1A664C	CSM C	EMANDI JAYACHANDRA
24BD1A664D	CSM C	ESHWAR SAI ELUGAM
24BD1A664E	CSM C	G VIGNESH YADAV
24BD1A664F	CSM C	G.MITESH REDDY
24BD1A664G	CSM C	GADDALA HADASSA KEERTHI
24BD1A664H	CSM C	GOPU VARSHINI
24BD1A664J	CSM C	GUTHA SRI SAI
24BD1A664K	CSM C	HIMESHJAISWAL
24BD1A664L	CSM C	J.DIVYA
24BD1A664M	CSM C	JADHAV AKASH NAYAK
24BD1A664N	CSM C	JAWAJI AISHWARYA
24BD1A664P	CSM C	JOSYULA KARTHIKEYA
24BD1A664Q	CSM C	K SHARAN TEJA GOUD
24BD1A664R	CSM C	KAMIDI SIDDHARTHA REDDY
24BD1A664T	CSM C	KANAK KABRA
24BD1A664U	CSM C	KANTHI MEENA SRI
24BD1A664V	CSM C	KODAPAKA MRUDULA
24BD1A664W	CSM C	KUNTA MEDHAMSH REDDY
24BD1A664X	CSM C	KURVA RAMU
24BD1A664Y	CSM C	LANKAPOTHU  HIRANMAI
24BD1A664Z	CSM C	MADDI PURVAJA
24BD1A6651	CSM C	MADIREDDI LAKSHMI ANIL ADITYA
24BD1A6652	CSM C	MANGAYI MADHU
24BD1A6653	CSM C	MANIKONDA  ANCHITA
24BD1A6654	CSM C	MANIKYALA YASHSHAWINI RAO
24BD1A6655	CSM C	MD ANAS
24BD1A6656	CSM C	MEDIPALLY KUSHAL
24BD1A6657	CSM C	MUNIGELA ESHWARPRASAD
24BD1A6658	CSM C	NAGABATTULA HAASINI
24BD1A6659	CSM C	NEHA GARLAPAD
24BD1A665A	CSM C	NETALA SUJAL
24BD1A665B	CSM C	PENDYAL GAURAV
24BD1A665C	CSM C	PERMA KUSHAL MADHAN
24BD1A665D	CSM C	POTHNAK VISHNU
24BD1A665E	CSM C	PULUMATI SIDDARTH
24BD1A665F	CSM C	RAMIREDDY UDAYKIRAN REDDY
24BD1A665G	CSM C	SALUPALA BUNNY
24BD1A665H	CSM C	SANJAY ALLI
24BD1A665J	CSM C	SANJUKTHA RANGISETTY
24BD1A665K	CSM C	SHAMAKURA SAITEJA GOUD
24BD1A665L	CSM C	SIDDI PREMSAI
24BD1A665M	CSM C	SNEHITH BHANDWALKAR
24BD1A665N	CSM C	SOGALAPALLI MANJUNATH REDDY
24BD1A665P	CSM C	TANAY KEERTHI
24BD1A665Q	CSM C	TANUSHREE GADALAY
24BD1A665R	CSM C	THODSAM SRUJAN
24BD1A665T	CSM C	TINGIRKAR SINDHU
24BD1A665U	CSM C	TINGRIKAR YOGESH RAJ
24BD1A665V	CSM C	UMANG GODNAHA
24BD1A665W	CSM C	UPADHYAYULA ADITYA VARDHAN
24BD1A665X	CSM C	VASIREDDY VIGNESH REDDY
24BD1A665Y	CSM C	VATTIKUTI CHANDRA SHEKAR
24BD1A665Z	CSM C	VELIMINETI NANDHI VARDHAN REDDY
24BD1A66K3	CSM C	YARRAMADA LOHITH REDDY
24BD1A6661	CSM D	AFSHEEN RAFI
24BD1A6662	CSM D	ALLADI ARPITHA SHARON
24BD1A6663	CSM D	AMRUTA SHEETAL MEKHALE
24BD1A6664	CSM D	ANUKOLU SANJANA
24BD1A6665	CSM D	ANUSHKA BHANDARI
24BD1A6666	CSM D	APPOJU PRANAV ADITHYA
24BD1A6667	CSM D	ASMITA MATHUR
24BD1A6668	CSM D	AYESHA UMNA
24BD1A6669	CSM D	BANOTH JAHNAVI
24BD1A666A	CSM D	BANOTHU RAJKUMAR
24BD1A666B	CSM D	BANOTHU UDAY KIRAN
24BD1A666C	CSM D	BATTULA RATHAN RAJ
24BD1A666D	CSM D	BODA ARUN
24BD1A666E	CSM D	CHAKINAM RANA PRATHAP
24BD1A666F	CSM D	CHARAN SAI MAMIDALA
24BD1A666G	CSM D	DANDAM HASINI
24BD1A666H	CSM D	DASARI AKHIL KUMAR
24BD1A666J	CSM D	DIVIJ DIWAN
24BD1A666K	CSM D	GANGADARI KEERTHANA
24BD1A666L	CSM D	GOGIKAR LOKESH
24BD1A666M	CSM D	GUJJULA SURYATEJA
24BD1A666N	CSM D	GUNUKULA SHASHANK
24BD1A666P	CSM D	JAMMULA RUSHITHA
24BD1A666Q	CSM D	JANGAM DEVENDER NATH
24BD1A666R	CSM D	JILLELLA SATHWIK
24BD1A666T	CSM D	KAITHI HANSIKA
24BD1A666U	CSM D	KANTHI JASHWANTH
24BD1A666V	CSM D	KASTHALA VAMSRIDAR RAO
24BD1A666W	CSM D	KODAMAGUNDLA AKSHAYA
24BD1A666X	CSM D	KOMMERA SUPRATHEEK REDDY
24BD1A666Y	CSM D	KOPULA  SHRINAINA
24BD1A666Z	CSM D	KUDUMULA SAI ARYAN REDDY
24BD1A6671	CSM D	KUMBOJU SHESHA SAI PRANAV
24BD1A6672	CSM D	LAKSHYA HINDOCHA
24BD1A6673	CSM D	MADDUKURI HARENDRA NADH CHOWDARY
24BD1A6674	CSM D	MALLAGUNTA VEDHA SREE
24BD1A6675	CSM D	MORAMGANTI KRUTHIKA REDDY
24BD1A6676	CSM D	MUKUND MUNDEL
24BD1A6677	CSM D	MUSTI NITHIN RAJ
24BD1A6678	CSM D	NADAKUDITI CHARITHA SRI
24BD1A6679	CSM D	NAGANABOINA SATHVIK
24BD1A667A	CSM D	NANDIT MARKANDEYA CHIRRAVURI
24BD1A667B	CSM D	PABBA DEEPTHI
24BD1A667C	CSM D	PALLE SADVIKA REDDY
24BD1A667D	CSM D	PALLERLA MAHANTH
24BD1A667E	CSM D	PATHEPURAM MYTHRI
24BD1A667F	CSM D	PEDASINGU SARATH
24BD1A667G	CSM D	PERUMALLAPALLI RITHWIKA
24BD1A667H	CSM D	POTTAPALLI SOWMYA
24BD1A667J	CSM D	R AASHISH
24BD1A667K	CSM D	RAMAVATH KAILASH
24BD1A667L	CSM D	RAVULA SIDHESHWAR REDDY
24BD1A667M	CSM D	ROYYA NIKHITH BHUSHAN
24BD1A667N	CSM D	RUDRANGI SRIKALA
24BD1A667P	CSM D	SAANVI REDDY GANTA
24BD1A667Q	CSM D	SREEJAN JALAGAM
24BD1A667R	CSM D	SRITHIKA MORE
24BD1A667T	CSM D	SURABHI NIMISHA RAO
24BD1A667U	CSM D	SUSHEEL VAKITI
24BD1A667V	CSM D	T.KRISHNA
24BD1A667W	CSM D	TANNIRU SHANMUKH ANJAN
24BD1A667X	CSM D	THADIGOPPULA RAM CHARAN
24BD1A667Y	CSM D	VADLA HARSHITH
24BD1A667Z	CSM D	VURE VISHWAROOP
24BD1A6681	CSM E	AJMEERA MOUNIKA
24BD1A6682	CSM E	ALLAM ROHITH
24BD1A6683	CSM E	AMBALA SPOORTHY REDDY
24BD1A6684	CSM E	ANGOORI CHITRESH
24BD1A6685	CSM E	APPANA YAKSHENDRA KUMAR
24BD1A6686	CSM E	ATMURI VEERA RAGHAVA
24BD1A6687	CSM E	BANAPURAM PRIYAL
24BD1A6688	CSM E	BANOTHU PRABHUDAS
24BD1A6689	CSM E	BANOTHU VARSHITHA
24BD1A668A	CSM E	BARADI  JAHNAVI
24BD1A668B	CSM E	BEESU JAYA SREE
24BD1A668C	CSM E	CHILUMULA KARTHIK
24BD1A668D	CSM E	CHOWVAN BHADRINATH
24BD1A668E	CSM E	DHAARNISRI NARAMAMIDI
24BD1A668F	CSM E	DHARAVATH DURGA BHAVANI
24BD1A668G	CSM E	G.NITHYA SANTOSHI
24BD1A668H	CSM E	GADDAM JASWANTH REDDY
24BD1A668J	CSM E	GUNTHA SRINITH
24BD1A668K	CSM E	ISHIKA SHIVARAM SHETTY
24BD1A668L	CSM E	JIYA ROCHIRAMANI
24BD1A668M	CSM E	KALI NIKHIL KUMAR
24BD1A668N	CSM E	KAMPATI MAHARSHI
24BD1A668P	CSM E	KANDUKURI VARUNIKA
24BD1A668Q	CSM E	KOLLOJU RAGHAVA
24BD1A668R	CSM E	KOMMAREDDY SNIKITHA REDDY
24BD1A668T	CSM E	KOPPULA PRANEETHA
24BD1A668U	CSM E	KORLAPATI MAHESWARI
24BD1A668V	CSM E	KOTHURI AKSHAYA
24BD1A668W	CSM E	KRISHNA POTHNAK
24BD1A668X	CSM E	KUKKAMUDI SIDDARTHA
24BD1A668Y	CSM E	LAVUDYA MUKESH NAIK
24BD1A668Z	CSM E	LOLLA VENKATA SRIRAM
24BD1A6691	CSM E	M.P VAISHNAV
24BD1A6692	CSM E	MALAVATH VAISHNAVI
24BD1A6693	CSM E	MALLAK VIBHU
24BD1A6694	CSM E	MOHAMMED REHAL
24BD1A6695	CSM E	MOOD JYOTHIKA
24BD1A6696	CSM E	MUTHIREDDY ABHINAV
24BD1A6697	CSM E	NANDAMUDI NAVADHEER SAI
24BD1A6698	CSM E	PALLE RUSHIKESH GOUD
24BD1A6699	CSM E	PALLEPOGU GNANADASU
24BD1A669A	CSM E	PAMARTHI SURYA SAI KRISHNA PURNA CHAND
24BD1A669B	CSM E	PANGA LIKHITHA
24BD1A669C	CSM E	PANNALA BHAVITHA
24BD1A669D	CSM E	PANYALA RASHMITHA REDDY
24BD1A669E	CSM E	PARKARI NIHAL
24BD1A669F	CSM E	PERAM VASISTA SAI
24BD1A669G	CSM E	RAJAMURI SPANDANA
24BD1A669H	CSM E	SABAVATH SWAPNA CHAUVAN
24BD1A669J	CSM E	SAIDANOLLA TEJA
24BD1A669K	CSM E	SANJEEV ROSHAN KUMAR
24BD1A669L	CSM E	SELVIKA ALLA
24BD1A669M	CSM E	SHAIK MOHAMMED ASIF
24BD1A669N	CSM E	SHAIK YASEEN
24BD1A669P	CSM E	THATIPALLI PRANAY
24BD1A669Q	CSM E	TINGIRKAR TEJASWINI
24BD1A669R	CSM E	UTKARSH JHA
24BD1A669T	CSM E	YADA NIRAJ KUMAR
24BD1A669U	CSM E	YALAMADDI BHOOMIKA
24BD1A669V	CSM E	YERRAM DHIRAJ SAI
`;

const processStudents = () => {
    return studentsData.trim().split('\n').filter(line => line.trim()).map(line => {
        // Split by tabs or multiple spaces
        const parts = line.trim().split(/\t+|\s{2,}/);

        if (parts.length >= 3) {
            const rollNo = parts[0].trim();
            const deptSection = parts[1].trim(); // "CSM A"
            const name = parts[2].trim();

            const [department, section] = deptSection.split(' ');

            return { rollNo, department, section, name };
        }
        return null;
    }).filter(s => s !== null);
};

const importData = async () => {
    try {
        console.log('ðŸ”Œ Connecting to MongoDB...');
        await mongoose.connect(process.env.MONGODB_URI);
        console.log('âœ… Connected');

        const students = processStudents();
        console.log(`Processing ${students.length} students...`);

        let added = 0;
        let updated = 0;
        let features = 0;

        for (const student of students) {
            const { rollNo, department, section, name } = student;
            const email = `${rollNo.toLowerCase()}@cmrec.ac.in`; // Assuming domain

            // Check if user exists
            let user = await User.findOne({
                $or: [
                    { rollNumber: rollNo },
                    { email: email }
                ]
            });

            if (user) {
                // Update existing
                user.name = name;
                user.department = department;
                user.section = section;
                user.rollNumber = rollNo; // Ensure roll is set
                if (!user.email) user.email = email;
                await user.save();
                updated++;
            } else {
                // Create new
                await User.create({
                    name,
                    email,
                    password: rollNo, // Will be hashed by pre-save
                    role: 'student',
                    rollNumber: rollNo,
                    department,
                    section,
                    isActive: true
                });
                added++;
            }
            if ((added + updated) % 20 === 0) process.stdout.write('.');
        }

        console.log(`\n\nâœ… Done!`);
        console.log(`Added: ${added}`);
        console.log(`Updated: ${updated}`);

        process.exit(0);
    } catch (err) {
        console.error('Error:', err);
        process.exit(1);
    }
};

importData();
